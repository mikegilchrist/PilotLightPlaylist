#!/usr/bin/env python3
# Purpose: Coordinate PilotLight scraper and playlist update, with dry-run & verbose modes and date-stamped intermediates
# Usage: python create_pilotlight_playlist.py [--dry-run/-n] [--verbose/-v]
# Date: 2025-08-04
# Version: 1.3.0
# Chat name: PilotLightPlaylist Orchestrator
# GPT Model: OpenAI o4-mini
# Attribution: Generated by Michael Gilchrist in collaboration with ChatGPT

import argparse
import subprocess
import sys
from datetime import datetime

SCRAPER  = "pilotlight_scraper.py"
PLAYLIST = "add_to_playlist.py"

def parse_args():
    p = argparse.ArgumentParser(
        description="Run PilotLight scraper then update Spotify playlists"
    )
    p.add_argument(
        "--dry-run", "-n",
        action="store_true",
        help="Simulate actions; do NOT push updates to Spotify"
    )
    p.add_argument(
        "--verbose", "-v",
        action="store_true",
        help="Show full output from child scripts"
    )
    return p.parse_args()

def main():
    args      = parse_args()
    run_date  = datetime.today().strftime("%Y-%m-%d")
    artist_file = f"upcoming_artists_{run_date}.csv"

    # Scraper flags (no dry-run support here)
    scraper_flags = ["--week_stop", "-1"]
    if args.verbose:
        scraper_flags.append("--verbose")

    # Playlist flags (dry-run + verbose)
    playlist_flags = []
    if args.verbose:
        playlist_flags.append("--verbose")
    if args.dry_run:
        playlist_flags.append("--dry-run")

    print(f"{'[DRY RUN] ' if args.dry_run else ''}Running scraper…")
    subprocess.run(
        [sys.executable, SCRAPER] + scraper_flags,
        check=True,
        stdout=(sys.stdout if args.verbose else None),
        stderr=(sys.stderr if args.verbose else None),
    )

    print(f"{'[DRY RUN] ' if args.dry_run else ''}Running playlist update…")
    subprocess.run(
        [sys.executable, PLAYLIST, artist_file] + playlist_flags,
        check=True,
        stdout=(sys.stdout if args.verbose else None),
        stderr=(sys.stderr if args.verbose else None),
    )

    print("All done.")

if __name__ == "__main__":
    main()
